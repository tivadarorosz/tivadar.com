---
layout: base
pageBodyClass: page-light-bg
---

<article class="post">
  <header class="post-header">
    <div class="post-tags">
      {% for tag in tags %}
        <span class="post-tag">{{ tag }}</span>
      {% endfor %}
    </div>
    
    <h1 class="post-title">{{ title }}</h1>
    <div class="post-meta">
      <time class="post-date" datetime="{{ date }}">{{ date | formatPostDate }}</time>
      <span class="post-separator">â€¢</span>
      <span class="post-reading-time">{{ content | readingTime }}</span>
    </div>
    
    {% if featureImage !== false %}
      {# Check if background has a hex value #}
      {% set backgroundColor = background %}
      {% if backgroundColor and backgroundColor.trim() !== "" %}
        {# If background has a value, ensure it has # prefix for hex color #}
        {% if not backgroundColor.startsWith('#') %}
          {% set backgroundColor = '#' + backgroundColor %}
        {% endif %}
      {% else %}
        {# If no background color provided, use a default #}
        {% set backgroundColor = "var(--color-terracotta)" %}
      {% endif %}
      
      <div class="post-feature-image" style="background-color: {{ backgroundColor }};">
        {% if icon %}
        <img src="{{ icon }}" alt="" class="post-icon" loading="lazy">
        {% endif %}
      </div>
    {% endif %}
  </header>
  
  <div class="post-content">
    {{ content | safe }}
  </div>
  
  <div class="post-separator-line"></div>
  
  <footer class="post-footer">
    <div class="post-social">
      <span class="social-links">
        <a href="https://x.com/tivadarorosz" class="insights-social-link">
          <img src="https://cdn.tivadarorosz.com/icons/x-logo.svg" alt="X" width="24" height="24">
        </a>
        <a href="https://instagram.com/tivadarorosz" class="insights-social-link">
          <img src="https://cdn.tivadarorosz.com/icons/instagram-logo.svg" alt="Instagram" width="24" height="24">
        </a>
      </span>
    </div>
    
    <section class="post-related">
      <div class="insights-main-grid">
        {# Filter out the current post by URL #}
        {% set otherPosts = [] %}
        {% for post in collections.allPosts %}
          {% if post.url != page.url %}
            {% set otherPosts = (otherPosts.push(post), otherPosts) %}
          {% endif %}
        {% endfor %}
        
        {# Improved random selection with better distribution #}
        {% set postCount = otherPosts.length %}
        {% if postCount > 0 %}
          {# Create better randomness using URL characteristics #}
          {% set urlSum = 0 %}
          {% for char in page.url %}
            {% set urlSum = urlSum + loop.index * loop.index %}
          {% endfor %}
          {% set seed = (urlSum * 17 + page.url.length * 31) % 1000 %}
          
          {# Create a shuffled copy of the posts for better randomization #}
          {% set remainingPosts = [] %}
          {% for post in otherPosts %}
            {% set remainingPosts = (remainingPosts.push(post), remainingPosts) %}
          {% endfor %}
          
          {# Pick 3 random posts with better distribution #}
          {% set selectedPosts = [] %}
          {% for i in range(0, 3) %}
            {% if remainingPosts.length > 0 %}
              {# Use prime numbers for better distribution #}
              {% set idx = (seed + i * 137 + i * i * 13) % remainingPosts.length %}
              {% set selectedPosts = (selectedPosts.push(remainingPosts[idx]), selectedPosts) %}
              {# Remove selected post from remaining posts #}
              {% set newRemaining = [] %}
              {% for j in range(0, remainingPosts.length) %}
                {% if j != idx %}
                  {% set newRemaining = (newRemaining.push(remainingPosts[j]), newRemaining) %}
                {% endif %}
              {% endfor %}
              {% set remainingPosts = newRemaining %}
            {% endif %}
          {% endfor %}
          
          {# Display selected posts #}
          {% for post in selectedPosts %}
          <a href="{{ post.url }}" class="insights-card" aria-label="Read {{ post.data.title }}">
            {% if post.data.featureImage === true %}
              {# Handle background color #}
              {% set backgroundColor = post.data.background %}
              {% if backgroundColor and backgroundColor.trim() !== "" %}
                {% if not backgroundColor.startsWith('#') %}
                  {% set backgroundColor = '#' + backgroundColor %}
                {% endif %}
              {% else %}
                {# Use random color from palette if no background specified #}
                {% set colorIndex = post.url.length % 10 %}
                {% set colorPalette = [
                  "var(--color-terracotta)",
                  "var(--color-pale-sage)",
                  "var(--color-soft-stone)",
                  "var(--color-warm-beige)",
                  "var(--color-neutral-cream)",
                  "var(--color-warm-bronze)",
                  "var(--color-sage-green)",
                  "var(--color-soft-blue)",
                  "var(--color-dusty-violet)",
                  "var(--color-light-purple)"
                ] %}
                {% set backgroundColor = colorPalette[colorIndex] %}
              {% endif %}
              
              <div class="insights-card-image-wrapper" style="background-color: {{ backgroundColor }};">
                {% if post.data.icon %}
                <img src="{{ post.data.icon }}" alt="" class="insights-card-icon" loading="lazy">
                {% endif %}
              </div>
            {% endif %}
            
            <div class="insights-card-content">
              <span class="insights-card-tag">{{ post.data.tags | join(', ') }}</span>
              <h3 class="insights-card-title">{{ post.data.title }}</h3>
              <time class="insights-card-date" datetime="{{ post.data.date }}">{{ post.data.date | formatPostDate }}</time>
            </div>
          </a>
          {% endfor %}
        {% endif %}
      </div>
    </section>
  </footer>
</article>